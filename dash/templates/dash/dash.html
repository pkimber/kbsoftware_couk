{% extends 'dash/base.html' %}
{% load staticfiles %}
{% load nvd3_tags %}

{% block sub_heading %}
  Dashboard
{% endblock sub_heading %}

{% block stylesheets_extra %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/css/nvd3/nv.d3.css' %}">
{% endblock stylesheets_extra %}

{% block content %}
  <div class="pure-g">
    <div class="pure-u-1">
      <div class="pure-menu pure-menu-horizontal">
        <ul class="pure-menu-list">
          {% include 'crm/_menu.html' %}
        </ul>
      </div>
    </div>
  </div>
  <div class="pure-g">
    <div class="pure-u-1 pure-u-md-1-3">
      <h4>Tickets</h4>
      <small>
        {% for ticket in tickets %}
          {{ ticket.pk }}
          <a href="{% url 'crm.ticket.detail' ticket.pk %}">
            {{ ticket.title|truncatewords:5 }}
          </a>
          ({{ ticket.contact.name|truncatewords:2 }})
          {% if not user == ticket.user %}
            (<strong>{{ ticket.user.username }}</strong>)
          {% endif %}
          <br>
        {% endfor %}
      </small>
    </div>
    <div class="pure-u-1 pure-u-md-1-3">
      <h4>Notes</h4>
      <small>
        {% for note in notes %}
          {{ note.ticket.pk }}
          (<a href="{% url 'crm.ticket.detail' note.ticket.pk %}">
            {{ note.ticket.title|truncatewords:2 }}
          </a>
          {{ note.ticket.contact.name|truncatewords:2 }})
          {{ note.title|truncatewords:5 }}
          {% if not user == note.user %}
            (<strong>{{ note.user.username }}</strong>)
          {% endif %}
          <br>
        {% endfor %}
      </small>
    </div>
    <div class="pure-u-1 pure-u-md-1-3">
      <h4>Time</h4>
      <small>
        {% for tr in time_records %}
          {{ tr.ticket.pk }}
          (<a href="{% url 'crm.ticket.detail' tr.ticket.pk %}">
            {{ tr.ticket.title|truncatewords:2 }}
          </a>
          {{ tr.ticket.contact.name|truncatewords:2 }})
          {{ tr.title|truncatewords:5 }}
          {% if not user == tr.user %}
            (<strong>{{ tr.user.username }}</strong>)
          {% endif %}
          <br>
        {% endfor %}
      </small>
    </div>
  </div>
  <div class="pure-g">
    {% for r in report %}
      {% ifchanged r.user %}
        </div>
        <div class="pure-g">
          <div class="pure-u-1">
            {% if r.user %}
              <h4>{{ r.user.username }}</h4>
            {% else %}
              <h4>Our Company</h4>
            {% endif %}
          </div>
        </div>
        <div class="pure-g">
      {% endifchanged r.user %}
      <div class="pure-u-1 pure-u-md-1-2">
        {{ r.caption }}
        {% include_container r.chartcontainer 300 350 %}
      </div>
    {% endfor %}
  </div>
{% endblock content %}

{% block script_extra %}
  {{ block.super }}
  <script src="{% static 'vendor/js/nvd3/d3.js' %}" type="text/javascript"></script>
  <script src="{% static 'vendor/js/nvd3/nv.d3.js' %}" type="text/javascript"></script>
  {% for r in report %}
    {% load_chart r.charttype r.chartdata r.chartcontainer r.extra %}
  {% endfor %}
{% endblock script_extra %}
